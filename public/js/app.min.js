function LandingView(){View.call(this),this.Init=function(){var a=new LandingComponents;$(a.Navigation).on("mouseover",function(a){var b=$(this);$(b).removeClass("flash"),setTimeout(function(){$(b).addClass("flash")},1)}),$(a.Navigation).on("mouseleave",function(a){$(this).removeClass("flash")})}}function ProfileView(){View.call(this),this.Init=function(){var a=new ProfileComponents,b=this.CSRF,c=this.USER_ID;$(a.Modals.AddPhoto).on("shown.bs.modal",function(a){function d(){var a=$(j).find("img");a.length?$(k).is(":visible")&&($(k).hide(),$(n).hide()):($(k).show(),$(n).hide(),$(o).prop("disabled",!0))}function e(a){$(j).prepend(a),$(o).prop("disabled",!1),d()}var f=$(this),g=f.find(".file-dropper"),h=f.find("#photoFromUrlField"),i=f.find("#photoFromFileField"),j=f.find(".img-preview-list"),k=j.find("h6"),l=f.find(".form-group").first(),m=f.find("#urlStatus"),n=f.find(".btn-xs"),o=f.find("#submitPhotoUpload");FileHandler.init(),d(),$(h).bind("input change",function(a){var b=$(this).val();$.trim(b)?b.match(Patterns.imgUrl())?ImageFactory(b).thumbnail(function(a){FormDecorator.okThenClear(l,m),e(a),$(h).val("")},function(a){FormDecorator.error(l,"Image failed to load.",m)}):FormDecorator.warn(l,"Invalid image URL",m):FormDecorator.clear(l,m)}),$(j).on("click","img",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected"),$(n).show()}),$(n).on("click",function(){for(var a=$(j).children(),b=0;b<a.length;b++)$(a[b]).hasClass("selected")&&($(a[b]).remove(),d())}),$(i).on("change",function(a){FileHandler.read(a,"\\image.*",function(a){ImageFactory(a).thumbnail(function(a){e(a)})})}),$(g).on("dragover",function(a){a.stopPropagation(),a.preventDefault(),FileHandler.copy(a),$(this).addClass("drop")}),$(g).on("dragleave",function(a){$(this).removeClass("drop")}),$(g).on("drop",function(a){a.stopPropagation(),a.preventDefault(),FileHandler.readDropped(a,"\\image.*",function(a){ImageFactory(a).thumbnail(function(a){e(a)})}),$(this).removeClass("drop")}),$(submitPhotoUpload).on("click",function(){for(var a=$(j).find("img"),e=[],f=0;f<a.length;f++)e[f]=$(a[f]).attr("src");AjaxHandler(function(b){$("#uploadNotify").text(b.upload_count+" photo(s) uploaded successfully"),$(a).remove(),d()},b,c).post("photos/upload",{photos:e})})}),$(a.Modals.AddPhoto).on("hidden.bs.modal",function(a){$(this).find("#photoFromUrlField").off("input change"),$(this).find("#photoFromFileField").off("change"),$(this).find("#submitPhotoUpload").off("click"),$(this).find("#uploadNotify").text(""),$(this).find(".file-dropper").off("dragover dragleave drop"),$(this).find(".img-preview-list").off("click","img")}),$(a.Modals.About).on("shown.bs.modal",function(a){var d=$("#aboutText").text(),e=$(this),f=e.find("textarea"),g=e.find(".form-group"),h=$("#submitAboutEdit");$(f).text(d),$(f).focus(),$(f).bind("input change",function(){$.trim($(f).val())?(FormDecorator.clear(g),$(h).prop("disabled",!1)):(FormDecorator.error(g,"This is a required field."),$(h).prop("disabled",!0))}),$(h).click(function(){if(!$(g).hasClass("has-error")){var a={data:$(f).val()};AjaxHandler(function(a){$($.parseHTML(a)).appendTo("#aboutText"),FormDecorator.ok($(g),"Update sucessful"),$(h).prop("disabled",!0)},b,c).post("about",a)}})}),$(a.Modals.About).on("hidden.bs.modal",function(a){FormDecorator.clear($(this).find(".form-group"))}),$(a.Modals.ViewPhoto).on("shown.bs.modal",function(a){function b(a){var b=$(e).clone();a.id==d&&$(b).addClass("active"),$(b).prepend(a),$(f).append(b)}function c(){var a=$(".user-photos").find("a").find("img").clone();$(a).removeClass("img-thumbnail").addClass("img-responsive");for(var c=0;c<a.length;c++)b(a[c])}var d=$(this).find("#sender").val(),e=$(this).find(".item").first(),f=$(this).find(".carousel-inner"),g=($(this).find(".left"),$(this).find(".right"),e);$(e).remove(),c(),$(this).on("hide.bs.modal",function(a){$(this).find(".item").remove(),$(this).append(g)})}),$(a.Modals.ViewPhoto).on("hidden.bs.modal",function(a){$(this).find("#sender").val("")}),$(a.Content.Photos).ready(function(){function b(a){var b=$("<a></a>").attr("href","#");$(b).append(a),$(".user-photos").append(b)}function d(){$(".user-photos").find("img").remove(),$.get("photos/get",{id:c},function(a){for(var c in a.photos)ImageFactory(a.photos[c].photo_src,a.photos[c].photo_id).thumbnail(function(a){b(a)})})}$(".user-photos").on("click","a",function(b){b.stopPropagation(),b.preventDefault();var c=$(this).find("img").attr("id");$(a.Modals.ViewPhoto).find("#sender").val(c),$(a.Modals.ViewPhoto).modal("show")}),$(a.Content.About).ready(function(){var a=$("#aboutText"),b=$(a).text();$(a).empty(),$($.parseHTML(b)).appendTo("#aboutText")}),d()})}}function View(){this.CSRF=$("meta[name='csrf_token']").attr("content"),this.USER_ID=$("meta[name='user_id']").attr("content")}var FileHandler={init:function(){jQuery.event.props.push("dataTransfer")},copy:function(a){a.dataTransfer.dropEffect="copy"},read:function(a,b,c){for(var d,e=a.target.files,f=0;d=e[f];f++)if(d.type.match(b)){var g=new FileReader;g.onload=function(a){c(a.target.result)},g.readAsDataURL(d)}},readDropped:function(a,b,c){for(var d,e=a.dataTransfer.files,f=0;d=e[f];f++)if(d.type.match(b)){var g=new FileReader;g.onload=function(a){c(a.target.result)},g.readAsDataURL(d)}}},Patterns={imgUrl:function(){return new RegExp(/(https?:\/\/.*\.(?:png|jp?g))/i)}},ImageFactory=function(a,b){return{src:a,id:b,thumbnail:function(c,d){var e=new Image;e.src=a,e.className="img-thumbnail",b?e.id=b:0,e.onload=function(){c(e)},e.onerror=function(){d(a)}},responsive:function(c,d){var e=new Image;e.src=a,e.className="img-responsive",b?e.id=b:0,e.onload=function(){c(e)},e.onerror=function(){d(a)}}}},AjaxHandler=function(a,b,c){return{csrf:b,oncompl:a,id:c,post:function(d,e){e._token=b,e.id=c,$.ajax({type:"POST",url:d,data:e}).done(function(b){a(b)})}}},FormDecorator={warn:function(a,b,c){if($(a).removeClass("has-error has-success"),$(a).addClass("has-warning"),c&&($(a).addClass("has-feedback"),$(c).removeClass("glyphicon-ok glyphicon-remove"),$(c).addClass("glyphicon-warning-sign"),$(c).show()),b){var d=$(a).find(".help-block").first();$(d).text(b)}},ok:function(a,b,c){if($(a).removeClass("has-error has-warning"),$(a).addClass("has-success"),c&&($(a).addClass("has-feedback"),$(c).removeClass("glyphicon-warning-sign glyphicon-remove"),$(c).addClass("glyphicon-ok"),$(c).show()),b){var d=$(a).find(".help-block").first();$(d).text(b)}},error:function(a,b,c){if($(a).removeClass("has-warning has-success"),$(a).addClass("has-error"),c&&($(a).addClass("has-feedback"),$(c).removeClass("glyphicon-warning-sign glyphicon-remove"),$(c).addClass("glyphicon-remove"),$(c).show()),b){var d=$(a).find(".help-block").first();$(d).text(b)}},okThenClear:function(a,b){$(a).removeClass("has-error has-warning"),$(a).addClass("has-success"),b?($(a).addClass("has-feedback"),$(b).removeClass("glyphicon-warning-sign glyphicon-remove"),$(b).addClass("glyphicon-ok"),$(b).show("fast",function(){$(b).hide("slow",function(){$(a).removeClass("has-warning has-success has-error has-feedback")})})):$(a).removeClass("has-warning has-success has-error has-feedback")},clear:function(a,b){$(a).removeClass("has-warning has-success has-error has-feedback"),b&&($(b).removeClass("glyphicon-ok glyphicon-remove glyphicon-warning-sign"),$(b).hide());var c=$(a).find(".help-block").first();c&&$(c).text("")}},ProfileComponents=function(){return{Modals:{About:$("#editAboutMod"),AddPhoto:$("#addPhotoMod"),ViewPhoto:$("#viewPhotoMod")},Content:{Photos:$("#photoContent"),About:$("#aboutText")}}},LandingComponents=function(){return{Navigation:$(".landing-nav-link")}};